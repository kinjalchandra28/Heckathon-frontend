<div class="px-10 py-6 bg-gray-100 min-h-full">
  <!-- Header Row -->
  <div class="flex justify-between items-center">
    <h2 class="text-2xl font-semibold">Explore Alarm Flows</h2>
    <div class="flex gap-2">
      <button
        mat-raised-button
        (click)="onRefresh()"
        [disabled]="loading"
        class="!bg-gray-600 !text-white"
      >
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
      <button mat-raised-button color="primary">Create</button>
    </div>
  </div>

  <!-- State Container: handles loading, error, and content states -->
  <app-state-container
    [loading]="loading"
    [error]="error"
    loadingMessage="Loading alarm flows..."
    errorTitle="Failed to load alarm flows"
    (retry)="onRefresh()"
  >
    <!-- Category Chips -->
    <div class="my-5">
      <mat-chip-listbox>
        <mat-chip-option
          *ngFor="let c of categories"
          [selected]="c === selectedCategory"
          (click)="onCategoryChange(c)"
        >
          {{ c }}
        </mat-chip-option>
      </mat-chip-listbox>
    </div>

    <!-- Results Count -->
    <div class="flex items-center justify-between mt-6 mb-3">
      <h3 class="font-semibold">
        {{ selectedCategory === 'All' ? 'All Alarm Flows' : selectedCategory }}
        <span class="text-gray-500 font-normal text-sm ml-2"
          >({{ filteredAgents.length }} {{ filteredAgents.length === 1 ? 'alarm' : 'alarms' }})</span
        >
      </h3>
    </div>

    <!-- Empty State -->
    @if (filteredAgents.length === 0) {
      <app-empty-state
        title="No alarm flows found"
        [message]="selectedCategory === 'All' ? 'No alarm flows available.' : 'Try selecting a different category.'"
        icon="inbox"
      ></app-empty-state>
    }

    <!-- Agent Cards Grid -->
    @if (filteredAgents.length > 0) {
      <div class="grid grid-cols-2 gap-5">
        <app-agent-card
          *ngFor="let item of filteredAgents"
          [agent]="item"
          (viewDetails)="openDetail($event)"
        ></app-agent-card>
      </div>
    }
  </app-state-container>
</div>

<!-- Explore Detail Panel -->
<app-explore-detail
  [agent]="selectedAgent"
  [isOpen]="isDetailOpen"
  (closePanel)="closeDetail()"
></app-explore-detail>
